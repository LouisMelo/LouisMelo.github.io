<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="ç”±äºé¡¹ç›®çš„éœ€è¦ï¼Œæˆ‘å°†å­¦ä¹ å¦‚ä½•åœ¨ä¸€å°ç©ºçš„Ubuntuæœºå™¨ä¸Šï¼Œé…ç½®Node.js + MongoDBçš„ç”Ÿäº§ç¯å¢ƒï¼Œè¿™é‡Œæ˜¯æ•´ä¸ªçš„æ­å»ºé…ç½®æµç¨‹ï¼Œä½¿ç”¨äº†DigitalOceanä½œä¸ºVPSï¼Œæ­å»ºäº†ä¸€ä¸ªè¿œç¨‹çš„ç¯å¢ƒï¼Œç”¨æ¥éƒ¨ç½²Node.js Appã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="ä½¿ç”¨DigitalOceanéƒ¨ç½²Node.js App">
<meta property="og:url" content="https://louismelo.github.io/2017/10/11/ä½¿ç”¨DigitalOceanéƒ¨ç½²Node-js-App/index.html">
<meta property="og:site_name" content="Louis - ä¸œç¯±ä¹‹ä¸‹">
<meta property="og:description" content="ç”±äºé¡¹ç›®çš„éœ€è¦ï¼Œæˆ‘å°†å­¦ä¹ å¦‚ä½•åœ¨ä¸€å°ç©ºçš„Ubuntuæœºå™¨ä¸Šï¼Œé…ç½®Node.js + MongoDBçš„ç”Ÿäº§ç¯å¢ƒï¼Œè¿™é‡Œæ˜¯æ•´ä¸ªçš„æ­å»ºé…ç½®æµç¨‹ï¼Œä½¿ç”¨äº†DigitalOceanä½œä¸ºVPSï¼Œæ­å»ºäº†ä¸€ä¸ªè¿œç¨‹çš„ç¯å¢ƒï¼Œç”¨æ¥éƒ¨ç½²Node.js Appã€‚">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://res.cloudinary.com/louismelo/image/upload/v1507714718/ss1_oebjdb.png">
<meta property="og:image" content="https://res.cloudinary.com/louismelo/image/upload/v1507715115/ss2_p9agbg.png">
<meta property="og:image" content="http://res.cloudinary.com/louismelo/image/upload/v1507715049/ss3_khxzzw.png">
<meta property="og:image" content="http://res.cloudinary.com/louismelo/image/upload/v1507793102/ss4_x9sig3.png">
<meta property="og:image" content="http://res.cloudinary.com/louismelo/image/upload/v1507793261/ss5_x9ji0i.png">
<meta property="og:updated_time" content="2017-10-12T07:29:17.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ä½¿ç”¨DigitalOceanéƒ¨ç½²Node.js App">
<meta name="twitter:description" content="ç”±äºé¡¹ç›®çš„éœ€è¦ï¼Œæˆ‘å°†å­¦ä¹ å¦‚ä½•åœ¨ä¸€å°ç©ºçš„Ubuntuæœºå™¨ä¸Šï¼Œé…ç½®Node.js + MongoDBçš„ç”Ÿäº§ç¯å¢ƒï¼Œè¿™é‡Œæ˜¯æ•´ä¸ªçš„æ­å»ºé…ç½®æµç¨‹ï¼Œä½¿ç”¨äº†DigitalOceanä½œä¸ºVPSï¼Œæ­å»ºäº†ä¸€ä¸ªè¿œç¨‹çš„ç¯å¢ƒï¼Œç”¨æ¥éƒ¨ç½²Node.js Appã€‚">
<meta name="twitter:image" content="http://res.cloudinary.com/louismelo/image/upload/v1507714718/ss1_oebjdb.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://louismelo.github.io/2017/10/11/ä½¿ç”¨DigitalOceanéƒ¨ç½²Node-js-App/"/>





  <title>ä½¿ç”¨DigitalOceanéƒ¨ç½²Node.js App | Louis - ä¸œç¯±ä¹‹ä¸‹</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Louis - ä¸œç¯±ä¹‹ä¸‹</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://louismelo.github.io/2017/10/11/ä½¿ç”¨DigitalOceanéƒ¨ç½²Node-js-App/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Louis Melo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Louis - ä¸œç¯±ä¹‹ä¸‹">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">ä½¿ç”¨DigitalOceanéƒ¨ç½²Node.js App</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-10-11T12:33:31+08:00">
                2017-10-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/å¼€å‘/" itemprop="url" rel="index">
                    <span itemprop="name">å¼€å‘</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>ç”±äºé¡¹ç›®çš„éœ€è¦ï¼Œæˆ‘å°†å­¦ä¹ å¦‚ä½•åœ¨ä¸€å°ç©ºçš„Ubuntuæœºå™¨ä¸Šï¼Œé…ç½®Node.js + MongoDBçš„ç”Ÿäº§ç¯å¢ƒï¼Œè¿™é‡Œæ˜¯æ•´ä¸ªçš„æ­å»ºé…ç½®æµç¨‹ï¼Œä½¿ç”¨äº†DigitalOceanä½œä¸ºVPSï¼Œæ­å»ºäº†ä¸€ä¸ªè¿œç¨‹çš„ç¯å¢ƒï¼Œç”¨æ¥éƒ¨ç½²Node.js Appã€‚</p>
<a id="more"></a>
<h2 id="æ­å»ºå¹¶é…ç½®VPS"><a href="#æ­å»ºå¹¶é…ç½®VPS" class="headerlink" title="æ­å»ºå¹¶é…ç½®VPS"></a>æ­å»ºå¹¶é…ç½®VPS</h2><p>åœ¨æˆ‘ä»¬å¼€å§‹ä¸€åˆ‡ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ä¸€ä¸ªå¯ä»¥è®¿é—®çš„æœåŠ¡å™¨ã€‚æœ‰è®¸å¤šçš„VPSå¯ä»¥ä¾›æˆ‘ä»¬é€‰æ‹©ï¼Œä¾‹å¦‚AWSï¼Œé˜¿é‡Œäº‘ï¼ŒDigitalOceanç­‰ç­‰ï¼Œæ‰€ä»¥ä¸å¿…æ‹˜æ³¥äºDigitalOceanã€‚ä¸è¿‡ï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œå»ºè®®æ ¹æ®æ•™ç¨‹ä¸€èµ·ï¼Œä½¿ç”¨DigitalOceanæ¥æ­å»ºæœåŠ¡å™¨ï¼Œå› ä¸ºå®ƒçœŸçš„æŒºä¸é”™çš„ã€‚</p>
<p>å¦‚æœä½ è¿˜æ²¡æœ‰DigitalOceançš„è´¦æˆ·ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç‚¹å‡»ä¸‹é¢è¿™ä¸ªé“¾æ¥ï¼Œå¯ä»¥å…è´¹è·å¾—10ç¾å…ƒï¼Œè¶³å¤Ÿè®©ä½ ç”¨ä¸¤ä¸ªæœˆï¼Œè¿˜æŒºä¸é”™çš„å§ã€‚</p>
<h3 id="åœ¨DigitalOceanä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„Droplet"><a href="#åœ¨DigitalOceanä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„Droplet" class="headerlink" title="åœ¨DigitalOceanä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„Droplet"></a>åœ¨DigitalOceanä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„Droplet</h3><p>åœ¨åˆ›å»ºå¥½è´¦æˆ·ï¼Œå¹¶ç™»é™†ä¹‹åï¼Œä½ å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„ç•Œé¢ï¼Œç‚¹å‡»â€Create Dropletâ€çš„æŒ‰é’®ã€‚</p>
<p><img src="http://res.cloudinary.com/louismelo/image/upload/v1507714718/ss1_oebjdb.png" alt="åˆ›å»ºDroplet"></p>
<p>é€‰æ‹©Ubuntu 16.04.3 x64 -&gt; é€‰æ‹©æœ€ä¾¿å®œçš„æ¯æœˆ5ç¾å…ƒçš„å‹å· -&gt; é€‰æ‹©æœåŠ¡å™¨çš„æ‰€åœ¨åŒºåŸŸï¼ˆæˆ‘é€‰äº†æ–°åŠ å¡ï¼Œå› ä¸ºæ„Ÿè§‰ç¦»å¾—æ¯”è¾ƒè¿‘å§ï¼‰ -&gt; æ·»åŠ SSH Key</p>
<p>è¿™é‡Œï¼Œæˆ‘æ˜¯ç”¨çš„æ˜¯Mac OSï¼Œæ‰€ä»¥å¯ä»¥æ‰“å¼€terminalï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å·²ç»å­˜åœ¨SSH key:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ls -la ~/.ssh</div></pre></td></tr></table></figure></p>
<p>å½“è¿”å›çš„åˆ—è¡¨ä¸­ï¼Œæœ‰å­˜åœ¨åä¸º <strong>id_rsa.pub</strong> çš„æ–‡ä»¶æ—¶ï¼Œè¯´æ˜ç³»ç»Ÿä¸­å·²ç»ç”Ÿæˆäº†SSH keyï¼Œåªéœ€è¦å¤åˆ¶å°±å¯ä»¥äº†ï¼Œå¤åˆ¶çš„å‘½ä»¤ä¸º:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># This copies the key in the clipboard, so you can paste with Command + V.</div><div class="line">pbcopy &lt; ~/.ssh/id_rsa.pub</div></pre></td></tr></table></figure></p>
<p>ç‚¹å‡»â€New SSH Keyâ€çš„æŒ‰é’®ï¼Œå°†SSH Keyç²˜è´´è¿›å»ï¼Œéšä¾¿èµ·ä¸€ä¸ªåå­—ï¼Œæ¯”å¦‚Louisâ€™s MBPï¼Œç„¶åä¿å­˜ã€‚<br>åœ¨ä¸‹é¢ï¼Œä¸ºä½ çš„Dropletèµ·ä¸€ä¸ªåå­—ï¼Œæœ€åç‚¹å‡»â€Createâ€æŒ‰é’®åˆ›å»ºå®ƒã€‚</p>
<p><img src="https://res.cloudinary.com/louismelo/image/upload/v1507715115/ss2_p9agbg.png" alt="é€‰æ‹©Dropletç§ç±»"></p>
<p>åˆ›å»ºæˆåŠŸåï¼Œé¡µé¢ä¼šè·³è½¬åˆ°Dropletåˆ—è¡¨é¡µé¢ï¼Œåœ¨æ–°çš„Dropletä¸Šä¼šæ˜¾ç¤ºå®ƒçš„IPåœ°å€ï¼Œç‚¹å‡»å¤åˆ¶å®ƒã€‚</p>
<p><img src="http://res.cloudinary.com/louismelo/image/upload/v1507715049/ss3_khxzzw.png" alt="å¤åˆ¶ipåœ°å€"></p>
<p>æ‰“å¼€terminalï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œæ¥è¿æ¥åˆ°ä½ çš„Dropletä¸Š:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ç¡®ä¿ç”¨ä½ çš„IPåœ°å€ï¼Œæ›¿æ¢ä¸‹é¢çš„128.199.175.122</div><div class="line">ssh root@128.199.175.122</div></pre></td></tr></table></figure></p>
<h3 id="å¯¹æœåŠ¡å™¨è¿›è¡ŒåŸºç¡€çš„å®‰å…¨è®¾ç½®"><a href="#å¯¹æœåŠ¡å™¨è¿›è¡ŒåŸºç¡€çš„å®‰å…¨è®¾ç½®" class="headerlink" title="å¯¹æœåŠ¡å™¨è¿›è¡ŒåŸºç¡€çš„å®‰å…¨è®¾ç½®"></a>å¯¹æœåŠ¡å™¨è¿›è¡ŒåŸºç¡€çš„å®‰å…¨è®¾ç½®</h3><p>å½“æˆ‘ä»¬ç™»å½•åˆ°æœåŠ¡å™¨ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å¯¹æœåŠ¡å™¨åšä¸€äº›åŸºç¡€çš„é…ç½®ï¼Œæ¥ç¡®ä¿å®ƒçš„å®‰å…¨æ€§ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªæ‹¥æœ‰ <strong>sudo</strong> æƒé™çš„æ–°ç”¨æˆ·ï¼Œåœ¨terminalä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adduser louis</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªå‘½ä»¤ä¼šè¦æ±‚æˆ‘ä»¬è¾“å…¥å¯†ç ï¼Œä»¥åŠä¸€äº›ç›¸å…³ä¿¡æ¯ï¼Œç›´æ¥å›è½¦å°±å¯ä»¥äº†ã€‚</p>
<p>åˆ›å»ºå®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <strong>id</strong> å‘½ä»¤æ¥æŸ¥çœ‹user:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">root@nodejs-deploy:~# id louis</div><div class="line">uid=1000(louis) gid=1000(louis) groups=1000(louis)</div></pre></td></tr></table></figure></p>
<p>ä¸ºäº†åœ¨æœåŠ¡å™¨ä¸Šè¿è¡ŒæŸäº›å‘½ä»¤ï¼Œæ¯”å¦‚è¯´restart servicesç­‰ï¼Œæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„ç”¨æˆ·æ·»åŠ åˆ° <strong>sudo</strong> ç”¨æˆ·ç»„é‡Œï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">usermod -aG sudo louis</div></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œå®Œæˆåï¼Œå†ä½¿ç”¨ <strong>id</strong> å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹louisçš„çŠ¶æ€:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">root@nodejs-deploy:~# id louis</div><div class="line">uid=1000(louis) gid=1000(louis) groups=1000(louis),27(sudo)</div></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬çš„louisç”¨æˆ·å·²ç»è¢«æ·»åŠ åˆ° <strong>sudo</strong> ç”¨æˆ·ç»„é‡Œäº†ã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬è¦å°†æˆ‘ä»¬çš„SSH keyæ·»åŠ ç»™æˆ‘ä»¬çš„æ–°ç”¨æˆ·ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿æˆ‘ä»¬çš„æ–°ç”¨æˆ·åœ¨ç™»å½•çš„æ—¶å€™ä¸éœ€è¦è¾“å…¥å¯†ç äº†ï¼Œå› ä¸ºæˆ‘ä»¬æ‰“ç®—ç¦æ­¢ç”¨æˆ·ä½¿ç”¨å¯†ç ç™»å½•è¿™ä¸ªæœåŠ¡å™¨æ¥æé«˜å®ƒçš„å®‰å…¨æ€§ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥å¾ˆé‡è¦:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># switch user to louis</div><div class="line">su - louis</div><div class="line"></div><div class="line"># make directory for ssh</div><div class="line">mkdir ~/.ssh</div><div class="line"></div><div class="line"># set the permissions to only allow this user into it</div><div class="line">chmod 700 ~/.ssh</div><div class="line"></div><div class="line"># create a file to store ssh key</div><div class="line">nano ~/.ssh/authorized_keys</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œï¼Œåœ¨å¦ä¸€ä¸ªterminalä¸­ï¼Œè¾“å…¥ä¹‹å‰çš„ <strong>pbcopy</strong> å‘½ä»¤ï¼Œæ¥å¤åˆ¶ssh keyï¼Œç‚¹å‡»pasteä¹‹åï¼Œè¾“å…¥ <em>ctrl+x</em>ï¼Œç„¶åé€€å‡ºã€‚è¦ç¡®è®¤æ˜¯å¦æˆåŠŸç²˜è´´çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ£€æµ‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat ~/.ssh/autohrized_keys</div></pre></td></tr></table></figure></p>
<p>åœ¨è¿™ä¹‹åï¼Œä¿®æ”¹è¿™ä¸ªæ–‡ä»¶çš„æƒé™å¹¶æ¨å‡º:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">chmod 600 ~/.ssh/authorized_keys</div><div class="line"></div><div class="line"># stop acting as the new user and become root again</div><div class="line">exit</div></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦é˜»æ­¢ä½¿ç”¨å¯†ç çš„ç™»å½•è¡Œä¸ºï¼Œå› ä¸ºæ¯ä¸ªæœåŠ¡å™¨éƒ½æœ‰ä¸€ä¸ªrootç”¨æˆ·ï¼Œè€Œä¸”è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„æ”»å‡»ç›®æ ‡ï¼Œå®ƒåˆæœ‰ç€éå¸¸å¼ºå¤§çš„æƒé™ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯å°†å®ƒé™åˆ¶èµ·æ¥ï¼Œç¡®ä¿æ²¡æœ‰äººå¯ä»¥ä½¿ç”¨å®ƒ:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># log out server as root</div><div class="line">exit</div><div class="line"></div><div class="line"># log into server as new user</div><div class="line">ssh louis@128.199.175.122</div></pre></td></tr></table></figure></p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°SSHçš„é…ç½®æ–‡ä»¶ï¼Œæ¥é˜»æ­¢å¯†ç ç™»å½•ï¼ŒåŒæ—¶é˜»æ­¢ä½¿ç”¨rootç”¨æˆ·è¿›è¡Œç™»å½•ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano /etc/ssh/sshd_config</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œéœ€è¦ä¿®æ”¹ä¸¤ä¸ªåœ°æ–¹:</p>
<ol>
<li><strong>PermitRootLogin Yes</strong> æ”¹ä¸º <strong>no</strong></li>
<li><strong>PasswordAuthentication Yes</strong> æ”¹ä¸º <strong>no</strong></li>
</ol>
<p>TIPS: å¯ä»¥ä½¿ç”¨ <em>ctrl+w</em> æ¥æœç´¢å†…å®¹è¿›è¡Œä¿®æ”¹</p>
<p>ä¿®æ”¹å®Œæˆåï¼ŒæŒ‰ä¸‹ <em>ctrl+x</em> ä»¥åŠ <em>y</em> æ¨å‡ºç¼–è¾‘å¹¶ä¿å­˜ã€‚è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œé‡å¯sshæœåŠ¡:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo systemctl reload sshd</div></pre></td></tr></table></figure></p>
<p>è¿™æ—¶ï¼Œæ–°å»ºä¸€ä¸ªterminalçª—å£ï¼Œå°è¯•ä½¿ç”¨rootç™»å½•çš„è¯ï¼Œåº”è¯¥ä¼šå¤±è´¥ã€‚æ˜¾ç¤ºPermission denied (publickey)ã€‚</p>
<p>æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ä¸€ä¸ªç®€å•çš„é˜²ç«å¢™ï¼Œæˆ‘ä»¬å°†åªå…è®¸HTTP, HTTPSä»¥åŠSSHã€‚è¿™å°†ä¼šå‡å°‘å¾ˆå¤§ä¸€éƒ¨åˆ†çš„å®‰å…¨éšæ‚£ï¼Œå½“ç„¶è¿™ä¹Ÿåªæ˜¯ç®€å•çš„é…ç½®ï¼Œè¿™é‡Œä¸å¯¹å®‰å…¨åšè¿‡å¤šçš„æ·±å…¥äº†ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># enable OpenSSH connections</div><div class="line">sudo ufw allow OpenSSH</div><div class="line"></div><div class="line"># enable HTTP traffic</div><div class="line">sudo ufw allow http</div><div class="line"></div><div class="line"># enable HTTPS traffic</div><div class="line">sudo ufw allow https</div><div class="line"></div><div class="line"># turn the firewall on</div><div class="line">sudo ufw enable</div></pre></td></tr></table></figure></p>
<p>åœ¨å¯åŠ¨å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹é˜²ç«å¢™çš„çŠ¶æ€:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">louis@nodejs-deploy:~$ sudo ufw status</div><div class="line">Status: active</div><div class="line"></div><div class="line">To                         Action      From</div><div class="line">--                         ------      ----</div><div class="line">OpenSSH                    ALLOW       Anywhere</div><div class="line">80                         ALLOW       Anywhere</div><div class="line">443                        ALLOW       Anywhere</div><div class="line">OpenSSH (v6)               ALLOW       Anywhere (v6)</div><div class="line">80 (v6)                    ALLOW       Anywhere (v6)</div><div class="line">443 (v6)                   ALLOW       Anywhere (v6)</div></pre></td></tr></table></figure></p>
<h2 id="è¿è¡ŒNode-js-App"><a href="#è¿è¡ŒNode-js-App" class="headerlink" title="è¿è¡ŒNode.js App"></a>è¿è¡ŒNode.js App</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„æœåŠ¡å™¨å·²ç»é…ç½®å®Œæˆäº†ï¼Œæ‰€ä»¥å¼€å§‹å‡†å¤‡è¿è¡Œæˆ‘ä»¬çš„Appå§ï¼</p>
<h3 id="å®‰è£…Git"><a href="#å®‰è£…Git" class="headerlink" title="å®‰è£…Git"></a>å®‰è£…Git</h3><p>åœ¨Dropletä¸­ï¼Œå…¶å®å·²ç»é¢„è£…äº†Gitï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å®‰è£…:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">louis@nodejs-deploy:~$ git --version</div><div class="line">git version 2.7.4</div></pre></td></tr></table></figure></p>
<p>å¦‚æœæ²¡æœ‰å®‰è£…çš„è¯ï¼Œå®‰è£…èµ·æ¥ä¹Ÿå¾ˆæ–¹ä¾¿:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install git</div></pre></td></tr></table></figure></p>
<h3 id="å®‰è£…MongoDB"><a href="#å®‰è£…MongoDB" class="headerlink" title="å®‰è£…MongoDB"></a>å®‰è£…MongoDB</h3><p>å®‰è£…MongoDBçš„æ­¥éª¤å¯ä»¥å‚ç…§å®˜æ–¹æ–‡æ¡£:<a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/" target="_blank" rel="external">https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/</a></p>
<p>é¦–å…ˆï¼Œéœ€è¦å¯¼å…¥public key:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 0C49F3730359A14518585931BC711F9BA15703C6</div><div class="line"></div><div class="line">Executing: /tmp/tmp.496APU6jBy/gpg.1.sh --keyserver</div><div class="line">hkp://keyserver.ubuntu.com:80</div><div class="line">--recv</div><div class="line">0C49F3730359A14518585931BC711F9BA15703C6</div><div class="line">gpg: requesting key A15703C6 from hkp server keyserver.ubuntu.com</div><div class="line">gpg: key A15703C6: public key &quot;MongoDB 3.4 Release Signing Key &lt;packaging@mongodb.com&gt;&quot; imported</div><div class="line">gpg: Total number processed: 1</div><div class="line">gpg:               imported: 1  (RSA: 1)</div></pre></td></tr></table></figure></p>
<p>ç„¶åï¼Œé€‰æ‹©å¯¹åº”çš„Ubuntuç‰ˆæœ¬ï¼Œæ¥åˆ›å»ºä¸€ä¸ªlist file (Ubuntu 16.04):<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">echo &quot;deb [ arch=amd64,arm64 ] http://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.4 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-3.4.list</div></pre></td></tr></table></figure></p>
<p>æ›´æ–°apt-get:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get update</div></pre></td></tr></table></figure></p>
<p>å®‰è£…æœ€æ–°ç¨³å®šç‰ˆæœ¬çš„MongoDB:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install -y mongodb-org</div></pre></td></tr></table></figure></p>
<p>å¯åŠ¨MongoDB:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo service mongod start</div></pre></td></tr></table></figure></p>
<p>è¦åœ¨æœ¬æœºä¸Šä½¿ç”¨Robomongoè¿æ¥åˆ°è¿œç¨‹ä¸»æœºï¼Œç”±äºæˆ‘ä»¬å…³é—­äº†å¯†ç éªŒè¯ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨å°†è¿œç¨‹ä¸»æœºçš„27017ç«¯å£forwardåˆ°æˆ‘ä»¬çš„æœºå™¨ä¸Šï¼Œå…·ä½“è®¾ç½®å¦‚ä¸‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ssh louis@128.199.175.122 -L 27018:127.0.0.1:27017</div></pre></td></tr></table></figure></p>
<p>åœ¨Robomongoçš„è¿æ¥é¢æ¿ä¸­ï¼Œserverä¸º127.0.0.1ï¼Œç«¯å£å·ä¸º27018ã€‚è¿™æ ·å°±å¯ä»¥ä½¿ç”¨Robomongoè®¿é—®è¿œç¨‹ä¸»æœºä¸Šçš„MongoDBäº†ï¼Œè¿˜æ˜¯å¾ˆå®ç”¨çš„ã€‚</p>
<h3 id="å®‰è£…Node-js"><a href="#å®‰è£…Node-js" class="headerlink" title="å®‰è£…Node.js"></a>å®‰è£…Node.js</h3><p>è·Ÿgitç›¸æ¯”ï¼Œå®‰è£…node.jsè¦æ¯”è¾ƒéº»çƒ¦ä¸€ç‚¹ï¼Œå› ä¸ºæœ‰è®¸å¤šä¸åŒç‰ˆæœ¬çš„node.jsï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é€‰æ‹©æˆ‘ä»¬éœ€è¦çš„ç‰ˆæœ¬ï¼Œè®© <strong>apt-get</strong> æ¥è¿›è¡Œæ­£ç¡®çš„æ›´æ–°ã€‚æ‰§è¡Œä»¥ä¸‹çš„å‘½ä»¤ï¼Œæ¥è·å–å¹¶æ‰§è¡ŒNodeSourceæä¾›çš„setup script:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash -</div></pre></td></tr></table></figure></p>
<p>å½“ä¸Šé¢çš„æ‰§è¡Œå®Œæˆäº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ <strong>apt-get</strong> æ¥å®‰è£…node.jsäº†:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install nodejs</div></pre></td></tr></table></figure></p>
<p>å®‰è£…å®Œæˆåï¼Œå¯ä»¥æŸ¥çœ‹ç‰ˆæœ¬å·æ¥æ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸ:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">louis@nodejs-deploy:~$ node --version</div><div class="line">v6.11.4</div><div class="line">louis@nodejs-deploy:~$ npm --version</div><div class="line">3.10.10</div></pre></td></tr></table></figure></p>
<p>ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå°Appè¿›è¡Œæµ‹è¯•:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">cd ~</div><div class="line"></div><div class="line">mkdir apps</div><div class="line">cd apps/</div><div class="line"></div><div class="line">git clone https://github.com/bradtraversy/nodekb.git</div><div class="line"></div><div class="line">cd nodekb</div></pre></td></tr></table></figure></p>
<p>å®‰è£…nodemon:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo npm install -g nodemon</div></pre></td></tr></table></figure></p>
<p>å®‰è£…dependencies:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install</div></pre></td></tr></table></figure></p>
<p>ç”±äºè¿™ä¸ªå°ç¨‹åºæ˜¯è¿è¡Œåœ¨3000ç«¯å£ä¸Šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å°†é˜²ç«å¢™çš„3000ç«¯å£æ‰“å¼€ï¼Œè¿™æ ·æ‰å¯ä»¥è®¿é—®ï¼ˆåé¢Nginxå¯ä»¥åå‘ä»£ç†ï¼‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo ufw allow 3000</div></pre></td></tr></table></figure></p>
<p>è¿è¡ŒApp:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">louis@nodejs-deploy:~/apps/nodekb$ nodemon</div><div class="line">[nodemon] 1.12.1</div><div class="line">[nodemon] to restart at any time, enter `rs`</div><div class="line">[nodemon] watching: *.*</div><div class="line">[nodemon] starting `node app.js`</div><div class="line">Server started on port 3000...</div></pre></td></tr></table></figure></p>
<p>æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥åœ°å€:<a href="http://128.199.175.122:3000/" target="_blank" rel="external">http://128.199.175.122:3000/</a> å°±å¯ä»¥è®¿é—®Node.jsç¨‹åºäº†ã€‚</p>
<h2 id="ä½¿ç”¨PM2æ¥ç®¡ç†Node-js-App"><a href="#ä½¿ç”¨PM2æ¥ç®¡ç†Node-js-App" class="headerlink" title="ä½¿ç”¨PM2æ¥ç®¡ç†Node.js App"></a>ä½¿ç”¨PM2æ¥ç®¡ç†Node.js App</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå·²ç»å¯ä»¥æ‰‹åŠ¨å¯åŠ¨å¹¶è¿è¡ŒNode.jsç¨‹åºäº†ï¼Œä½†æ˜¯ä¸‡ä¸€æˆ‘ä»¬çš„æœåŠ¡å™¨é‡å¯äº†ï¼Œæˆ‘ä»¬å°±å¾—å†é‡æ–°æ‰§è¡Œä¸€éä¸Šè¿°çš„æ­¥éª¤ï¼Œè¿™å¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†è¦ä½¿ç”¨ä¸€ä¸ªå«åšPM2çš„process manageræ¥ç®¡ç†æˆ‘ä»¬çš„Node.js Appsã€‚</p>
<h3 id="å®‰è£…PM2"><a href="#å®‰è£…PM2" class="headerlink" title="å®‰è£…PM2"></a>å®‰è£…PM2</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo npm install -g pm2</div></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨PM2å¯åŠ¨App"><a href="#ä½¿ç”¨PM2å¯åŠ¨App" class="headerlink" title="ä½¿ç”¨PM2å¯åŠ¨App"></a>ä½¿ç”¨PM2å¯åŠ¨App</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">cd ~/apps/nodekb</div><div class="line"></div><div class="line">pm2 start app.js</div><div class="line"></div><div class="line">[PM2] Spawning PM2 daemon with pm2_home=/home/louis/.pm2</div><div class="line">[PM2] PM2 Successfully daemonized</div><div class="line">[PM2] Starting /home/louis/apps/nodekb/app.js in fork_mode (1 instance)</div><div class="line">[PM2] Done.</div><div class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</div><div class="line">â”‚ App name â”‚ id â”‚ mode â”‚ pid   â”‚ status â”‚ restart â”‚ uptime â”‚ cpu â”‚ mem       â”‚ user  â”‚ watching â”‚</div><div class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</div><div class="line">â”‚ app      â”‚ 0  â”‚ fork â”‚ 26669 â”‚ online â”‚ 0       â”‚ 0s     â”‚ 8%  â”‚ 19.7 MB   â”‚ louis â”‚ disabled â”‚</div><div class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div></pre></td></tr></table></figure>
<p>å¯åŠ¨åº”ç”¨åï¼Œä¼šå¾—åˆ°ä¸Šé¢çš„è¿”å›ç»“æœï¼Œè¯´æ˜appå·²ç»æˆåŠŸè¿è¡Œäº†ã€‚</p>
<h3 id="è®¾ç½®æœåŠ¡å™¨é‡å¯åè‡ªåŠ¨é‡å¯åº”ç”¨"><a href="#è®¾ç½®æœåŠ¡å™¨é‡å¯åè‡ªåŠ¨é‡å¯åº”ç”¨" class="headerlink" title="è®¾ç½®æœåŠ¡å™¨é‡å¯åè‡ªåŠ¨é‡å¯åº”ç”¨"></a>è®¾ç½®æœåŠ¡å™¨é‡å¯åè‡ªåŠ¨é‡å¯åº”ç”¨</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># change directory to app folder</div><div class="line">louis@nodejs-deploy:~$ cd ~/apps/nodekb</div><div class="line"></div><div class="line"># execute the following command</div><div class="line">louis@nodejs-deploy:~/apps/nodekb$ pm2 startup systemd</div><div class="line"></div><div class="line">[PM2] Init System found: systemd</div><div class="line">[PM2] To setup the Startup Script, copy/paste the following command:</div><div class="line">sudo env PATH=$PATH:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup systemd -u louis --hp /home/louis</div></pre></td></tr></table></figure>
<p>å½“æ‰§è¡Œ <strong>pm2 startup systemd</strong> åï¼Œç³»ç»Ÿä¼šè¿”å›ä¸€ä¸²å‘½ä»¤è¦æ±‚ä½ æ‰§è¡Œï¼Œè¿™æ—¶å¤åˆ¶ç²˜è´´å¹¶æ‰§è¡Œå°±å¯ä»¥äº†ã€‚</p>
<h2 id="ä½¿ç”¨Letâ€™s-Encryptè·å–å…è´¹çš„SSL-Certificate"><a href="#ä½¿ç”¨Letâ€™s-Encryptè·å–å…è´¹çš„SSL-Certificate" class="headerlink" title="ä½¿ç”¨Letâ€™s Encryptè·å–å…è´¹çš„SSL Certificate"></a>ä½¿ç”¨Letâ€™s Encryptè·å–å…è´¹çš„SSL Certificate</h2><p>SSLä¸€ç›´ä»¥æ¥å› ä¸ºæ˜‚è´µå’Œå¤æ‚æˆä¸ºå…¶æ™®åŠçš„éšœç¢ï¼Œä½†æ˜¯ç°åœ¨ï¼Œæœ‰äº›éå¸¸çƒ­å¿ƒçš„äººåˆ›é€ å‡ºäº†Letâ€™s Encryptè¿™ä¸ªå¥½ä¸œè¥¿ï¼Œä½¿å®ƒå˜å¾—ä¾¿å®œåˆç®€å•äº†ã€‚æ‰€ä»¥æˆ‘ä»¬ç°åœ¨è¦ç”¨å®ƒæ¥æé«˜æˆ‘ä»¬åŸŸåçš„å®‰å…¨æ€§ã€‚</p>
<h3 id="å®‰è£…Letâ€™s-Encrypt"><a href="#å®‰è£…Letâ€™s-Encrypt" class="headerlink" title="å®‰è£…Letâ€™s Encrypt"></a>å®‰è£…Letâ€™s Encrypt</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦å®‰è£…ä¸€ä¸ªLetâ€™s Encryptçš„ä¾èµ–æ–‡ä»¶ï¼Œå«åšbc:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># change directory to home</div><div class="line">cd ~</div><div class="line"></div><div class="line"># use apt-get to install it</div><div class="line">sudo apt-get install bc</div></pre></td></tr></table></figure></p>
<p>å®Œæˆåï¼Œæˆ‘ä»¬ä½¿ç”¨gitï¼Œå°†æ–‡ä»¶å¤åˆ¶è¿›/opt/letsencryptæ–‡ä»¶å¤¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo git clone https://github.com/letsencrypt/letsencrypt /opt/letsencrypt</div></pre></td></tr></table></figure></p>
<h3 id="å°†åŸŸåæŒ‡å‘æœåŠ¡å™¨"><a href="#å°†åŸŸåæŒ‡å‘æœåŠ¡å™¨" class="headerlink" title="å°†åŸŸåæŒ‡å‘æœåŠ¡å™¨"></a>å°†åŸŸåæŒ‡å‘æœåŠ¡å™¨</h3><p>ç”±äºåœ¨ç”ŸæˆSSLè¯ä¹¦ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå°†åŸŸåæŒ‡å‘æˆ‘ä»¬çš„æœåŠ¡å™¨ã€‚</p>
<p>æ‰€ä»¥è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦è·å–ä¸€ä¸ªåŸŸåï¼Œ è¿™é‡Œæˆ‘ä½¿ç”¨äº†è…¾è®¯äº‘çš„åŸŸåï¼Œç›®å‰è¿˜åœ¨å®åè®¤è¯å®¡æ ¸ä¸­â€¦ğŸ˜¢</p>
<p>åŸŸåå®¡æ ¸é€šè¿‡ï¼Œæˆ‘ä»¬ç»§ç»­ï¼Œåœ¨TencentCloudçš„æ§åˆ¶å°å°†åŸŸåæŒ‡å‘äº†æˆ‘ä»¬çš„ä¸»æœºIPåœ°å€åï¼Œæµ‹è¯•ä¹Ÿé€šè¿‡äº†ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">louis@nodejs-deploy:~$ dig +short www.louisnow.cn</div><div class="line">128.199.175.122</div></pre></td></tr></table></figure></p>
<p>è¿”å›çš„åœ°å€æ­£ç¡®ï¼è¯´æ˜ç»‘å®šå·²ç»æˆåŠŸäº†ï¼Œè¿™ä¸ªåŸŸåå·²ç»å¯ä»¥æˆåŠŸè®¿é—®äº†ï¼</p>
<h3 id="ç”ŸæˆSSLè¯ä¹¦"><a href="#ç”ŸæˆSSLè¯ä¹¦" class="headerlink" title="ç”ŸæˆSSLè¯ä¹¦"></a>ç”ŸæˆSSLè¯ä¹¦</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd /opt/letsencrypt</div><div class="line"></div><div class="line">./certbot-auto certonly --standalone</div></pre></td></tr></table></figure>
<p>åœ¨è¾“å…¥ä¸Šè¿°å‘½ä»¤ä¹‹åï¼Œä¼šè¦æ±‚ä½ è¾“å…¥ä¸€ä¸ªemailåœ°å€ï¼Œç”¨äºæ¥æ”¶ä¸€äº›å®‰å…¨é€šçŸ¥ã€‚ç„¶åä¼šè¦æ±‚ä½ è¾“å…¥ä½ çš„åŸŸåï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦è¾“å…¥ä¸¤ä¸ªåŸŸå(louisnow.cn,www.louisnow.cn)ï¼Œä½¿ç”¨é€—å·æˆ–è€…ç©ºæ ¼éš”å¼€å°±å¯ä»¥äº†ã€‚</p>
<h3 id="ä¸ºSSLè¯ä¹¦è®¾ç½®è‡ªåŠ¨ç»­è®¢"><a href="#ä¸ºSSLè¯ä¹¦è®¾ç½®è‡ªåŠ¨ç»­è®¢" class="headerlink" title="ä¸ºSSLè¯ä¹¦è®¾ç½®è‡ªåŠ¨ç»­è®¢"></a>ä¸ºSSLè¯ä¹¦è®¾ç½®è‡ªåŠ¨ç»­è®¢</h3><p>å¤„äºå®‰å…¨æ€§è€ƒè™‘ï¼ŒLetâ€™s Encryptä¼šåœ¨æ¯90å¤©åè¶…æœŸå¤±æ•ˆï¼ˆä¸€èˆ¬ä»˜è´¹çš„SSLè¯ä¹¦éƒ½æ˜¯ä¸€å¹´æ—¶é—´ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦ä¸ºè¿™ä¸ªè¯ä¹¦è®¾ç½®è‡ªåŠ¨ç»­è®¢ã€‚</p>
<p>Letâ€™s Encryptä¹Ÿæä¾›äº†ç»­è®¢çš„å‘½ä»¤:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/opt/letsencrypt/certbot-auto renew</div></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæ¯è¿‡90å¤©ï¼Œæˆ‘ä»¬å°±ç™»å½•æœåŠ¡å™¨æ£€æŸ¥ä¸€éæ˜¯å¦è¿‡æœŸï¼Œé‚£ä¹ˆå°†ä¼šå¾ˆè›‹ç–¼ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå·¥å…·ä¸ºæˆ‘ä»¬æ¥å®Œæˆè‡ªåŠ¨ç»­è®¢çš„äº‹æƒ…ï¼Œå®ƒå«åš <strong>cron</strong> ã€‚ä½ å¯ä»¥åœ¨terminalä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥ç¼–è¾‘cronçš„ä»»åŠ¡:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo crontab -e</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œä¼šè¯¢é—®ä½¿ç”¨å“ªä¸€ç§ç¼–è¾‘å™¨ï¼Œç”±äºnanoè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­ä½¿ç”¨nanoã€‚åœ¨æ–‡ä»¶çš„æœ€åº•éƒ¨è¾“å…¥å¦‚ä¸‹å‘½ä»¤:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># æ¯å‘¨æ˜ŸæœŸä¸€çš„ä¸€ç‚¹é’Ÿè¿è¡Œä»£ç ï¼Œå¹¶å°†æ—¥å¿—å­˜å‚¨åœ¨æŒ‡å®šä½ç½®</div><div class="line">00 1 * * 1 /opt/letsencrypt/certbot-auto renew &gt;&gt; /var/log/letsencrypt-renewal.log</div><div class="line"></div><div class="line"># æ¯å‘¨æ˜ŸæœŸä¸€çš„ä¸€ç‚¹åŠé‡å¯nginxï¼Œä¿è¯ä½¿ç”¨æ–°ç”Ÿæˆçš„SSLè¯ä¹¦</div><div class="line">30 1 * * 1 /bin/systemctl reload nginx</div></pre></td></tr></table></figure></p>
<h2 id="å°†åŸŸåæŒ‡å‘App"><a href="#å°†åŸŸåæŒ‡å‘App" class="headerlink" title="å°†åŸŸåæŒ‡å‘App"></a>å°†åŸŸåæŒ‡å‘App</h2><p>åœ¨ä¸Šé¢çš„æ“ä½œä¸­ï¼Œæˆ‘ä»¬ä¸ºäº†æ–¹ä¾¿å°†3000ç«¯å£å¼€æ”¾å‡ºæ¥æ–¹ä¾¿è®¿é—®è°ƒè¯•ï¼Œå…¶å®è¿™ç§åšæ³•æ˜¯ä¸å¤ªå®‰å…¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨è¦å…³é—­3000ç«¯å£ï¼Œå¹¶ä½¿ç”¨nginxåå‘ä»£ç†æ¥å®Œæˆå¯¹äºAppçš„è®¿é—®ã€‚å‚è€ƒ: <a href="http://wiki.ubuntu.org.cn/UFW%E9%98%B2%E7%81%AB%E5%A2%99%E7%AE%80%E5%8D%95%E8%AE%BE%E7%BD%AE" target="_blank" rel="external">UFWé˜²ç«å¢™ç®€å•è®¾ç½®</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">sudo ufw delete allow 3000</div><div class="line">Rule deleted</div><div class="line">Rule deleted (v6)</div><div class="line"></div><div class="line">sudo ufw status</div><div class="line">Status: active</div><div class="line"></div><div class="line">To                         Action      From</div><div class="line">--                         ------      ----</div><div class="line">OpenSSH                    ALLOW       Anywhere</div><div class="line">80                         ALLOW       Anywhere</div><div class="line">443                        ALLOW       Anywhere</div><div class="line">OpenSSH (v6)               ALLOW       Anywhere (v6)</div><div class="line">80 (v6)                    ALLOW       Anywhere (v6)</div><div class="line">443 (v6)                   ALLOW       Anywhere (v6)</div></pre></td></tr></table></figure></p>
<p>è¿™æ ·ï¼Œ3000ç«¯å£å°±å…³é—­äº†ï¼Œæˆ‘ä»¬å†å°è¯•ä»å¤–éƒ¨è®¿é—®3000ç«¯å£åº”è¯¥æ˜¯å¤±è´¥çš„ã€‚</p>
<h3 id="å®‰è£…Nginx"><a href="#å®‰è£…Nginx" class="headerlink" title="å®‰è£…Nginx"></a>å®‰è£…Nginx</h3><p>ç°åœ¨æ¥å®‰è£…Nginxï¼Œè¿™é‡Œè¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œä½¿ç”¨apt-getå°±å¯ä»¥äº†:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install nginx</div></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦ç¡®ä¿æ‰€æœ‰çš„æµé‡éƒ½æ˜¯åœ¨SSLä¸Šä¼ è¾“çš„ï¼Œæˆ‘ä»¬è¦å°†æ‰€æœ‰éSSLçš„æµé‡é‡å®šå‘åˆ°SSLç‰ˆæœ¬ä¸Šï¼Œå¦‚æœæŸäººè®¿é—®äº†<a href="http://www.louisnow.cné‚£ä¹ˆä»–ä¼šè¢«è‡ªåŠ¨é‡å®šå‘åˆ°https://www.louisnow.cnä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹Nginxçš„é…ç½®æ–‡ä»¶" target="_blank" rel="external">http://www.louisnow.cné‚£ä¹ˆä»–ä¼šè¢«è‡ªåŠ¨é‡å®šå‘åˆ°https://www.louisnow.cnä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹Nginxçš„é…ç½®æ–‡ä»¶</a>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano /etc/nginx/sites-enabled/default</div></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨ <strong>ctrl+k</strong> åˆ é™¤æ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œç„¶åå°†ä¸‹é¢çš„å†…å®¹copyè¿›å»å°±å¯ä»¥äº†:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># HTTP â€” redirect all traffic to HTTPS</div><div class="line">server &#123;</div><div class="line">    listen 80;</div><div class="line">    listen [::]:80 default_server ipv6only=on;</div><div class="line">    return 301 https://$host$request_uri;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä¸‹é¢è¿˜æœ‰ä¸€æ­¥ï¼Œåªéœ€è¦ä¸€è¡Œä»£ç ï¼Œå°±å¯ä»¥è®©æˆ‘ä»¬çš„Appæ›´åŠ å®‰å…¨ï¼Œå°±æ˜¯å»ºç«‹ä¸€ä¸ª<a href="https://zh.wikipedia.org/wiki/%E8%BF%AA%E8%8F%B2-%E8%B5%AB%E7%88%BE%E6%9B%BC%E5%AF%86%E9%91%B0%E4%BA%A4%E6%8F%9B" target="_blank" rel="external">Diffie-Hellman-Group</a>ï¼Œè™½ç„¶æˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥šè¿™é‡Œçš„åŸç†ï¼Œæ€»ä¹‹è¿˜æ˜¯åŠ ä¸Šå§â€¦:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048</div></pre></td></tr></table></figure></p>
<p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦ç»™SSLåˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano /etc/nginx/snippets/ssl-params.conf</div></pre></td></tr></table></figure></p>
<p>å°†ä¸‹é¢çš„å†…å®¹copyåˆ°æ‰“å¼€çš„æ–‡ä»¶ä¸­å¹¶ä¿å­˜é€€å‡º:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"># See https://cipherli.st/ for details on this configuration</div><div class="line">ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</div><div class="line">ssl_prefer_server_ciphers on;</div><div class="line">ssl_ciphers &quot;EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH&quot;;</div><div class="line">ssl_ecdh_curve secp384r1; # Requires nginx &gt;= 1.1.0</div><div class="line">ssl_session_cache shared:SSL:10m;</div><div class="line">ssl_session_tickets off; # Requires nginx &gt;= 1.5.9</div><div class="line">ssl_stapling on; # Requires nginx &gt;= 1.3.7</div><div class="line">ssl_stapling_verify on; # Requires nginx =&gt; 1.3.7</div><div class="line">resolver 8.8.8.8 8.8.4.4 valid=300s;</div><div class="line">resolver_timeout 5s;</div><div class="line">add_header Strict-Transport-Security &quot;max-age=63072000; includeSubDomains; preload&quot;;</div><div class="line">add_header X-Frame-Options DENY;</div><div class="line">add_header X-Content-Type-Options nosniff;</div><div class="line"></div><div class="line"># Add our strong Diffie-Hellman group</div><div class="line">ssl_dhparam /etc/ssl/certs/dhparam.pem;</div></pre></td></tr></table></figure></p>
<p>ç»§ç»­é…ç½®Nginxæ–‡ä»¶:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano /etc/nginx/sites-enabled/default</div></pre></td></tr></table></figure></p>
<p>å°†ä¸‹é¢çš„å†…å®¹copyåˆ°ä¹‹å‰çš„å†…å®¹åé¢:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"># HTTPS â€” proxy all requests to the Node app</div><div class="line">server &#123;</div><div class="line">    # Enable HTTP/2</div><div class="line">    listen 443 ssl http2;</div><div class="line">    listen [::]:443 ssl http2;</div><div class="line">    server_name www.louisnow.cn;</div><div class="line"></div><div class="line">    # Use the Letâ€™s Encrypt certificates</div><div class="line">    ssl_certificate /etc/letsencrypt/live/www.louisnow.cn/fullchain.pem;</div><div class="line">    ssl_certificate_key /etc/letsencrypt/live/www.louisnow.cn/privkey.pem;</div><div class="line"></div><div class="line">    # Include the SSL configuration from cipherli.st</div><div class="line">    include snippets/ssl-params.conf;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">        proxy_set_header X-Real-IP $remote_addr;</div><div class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</div><div class="line">        proxy_set_header X-NginX-Proxy true;</div><div class="line">        proxy_pass http://localhost:3000/;</div><div class="line">        proxy_ssl_session_reuse off;</div><div class="line">        proxy_set_header Host $http_host;</div><div class="line">        proxy_cache_bypass $http_upgrade;</div><div class="line">        proxy_redirect off;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¦æ³¨æ„å°†åŸŸåç›¸å…³çš„åœ°æ–¹è¿›è¡Œæ›¿æ¢ï¼Œå¹¶ä¸”ç”±äºæˆ‘ä»¬çš„Appæ˜¯è¿è¡Œåœ¨3000ç«¯å£ä¸Šçš„ï¼Œæ‰€ä»¥åœ¨proxy_passåé¢å¡«ä¸Š<a href="http://localhost:3000/" target="_blank" rel="external">http://localhost:3000/</a></p>
<p>åœ¨å¯åŠ¨æœåŠ¡å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæµ‹è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å‡ºé—®é¢˜:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nginx -t</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæˆ‘å°±å‡ºé—®é¢˜äº†ï¼Œç”±äºå°†é…ç½®æ–‡ä»¶ä¸­çš„åŸŸåå†™æˆ <strong>www.louisnow.cn</strong> å¯¼è‡´äº†é”™è¯¯ï¼Œè¿™é‡Œåº”è¯¥å°† <strong>www</strong> å»æ‰å°±å¯ä»¥äº†ï¼Œå†æ¬¡æµ‹è¯•ï¼Œé€šè¿‡!<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo nginx -t</div><div class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</div><div class="line">nginx: configuration file /etc/nginx/nginx.conf test is successful</div></pre></td></tr></table></figure></p>
<p>æœ€åï¼Œè¿è¡Œnginxå³å¯:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo systemctl start nginx</div></pre></td></tr></table></figure></p>
<p>è®¿é—®www.louisnow.cnï¼Œå½“æ—¶å‘ç°é¡µé¢ä¸å¯¹å•Šï¼Œè¿™é‡Œå¯èƒ½å› ä¸ºæœåŠ¡å™¨è¿˜æ²¡åˆ·æ–°ï¼Œæ‰€ä»¥æˆ‘ä»¬å›åˆ°terminalï¼Œé‡æ–°å¯åŠ¨ä¸€ä¸‹nginx:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo systemctl restart nginx</div></pre></td></tr></table></figure></p>
<p>ç„¶åå†å›åˆ°æµè§ˆå™¨ï¼ŒæŒ‰ä½ <strong>shift+command+R</strong> å°±å¯ä»¥äº†ï¼</p>
<p><img src="http://res.cloudinary.com/louismelo/image/upload/v1507793102/ss4_x9sig3.png" alt="é¦–é¡µ"></p>
<p>æ³¨å†Œç•Œé¢<br><img src="http://res.cloudinary.com/louismelo/image/upload/v1507793261/ss5_x9ji0i.png" alt="æ³¨å†Œç•Œé¢"></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/10/10/ç†è´¢çŸ¥è¯†æ•´ç†ï¼ˆSept-ï¼‰/" rel="next" title="ç†è´¢çŸ¥è¯†æ•´ç†ï¼ˆSept.ï¼‰">
                <i class="fa fa-chevron-left"></i> ç†è´¢çŸ¥è¯†æ•´ç†ï¼ˆSept.ï¼‰
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/10/15/Node-js-Webå¼€å‘ï¼ˆä¸‰ï¼‰/" rel="prev" title="Node.js Webå¼€å‘ï¼ˆä¸‰ï¼‰">
                Node.js Webå¼€å‘ï¼ˆä¸‰ï¼‰ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image"
              src="/images/avatar.png"
              alt="Louis Melo" />
          
            <p class="site-author-name" itemprop="name">Louis Melo</p>
            <p class="site-description motion-element" itemprop="description">å¹³å‡¡çš„äººç”Ÿåƒç¯‡ä¸€å¾‹ï¼Œè€Œä¸å‡¡çš„äººç”Ÿä¸‡é‡ŒæŒ‘ä¸€ã€‚</p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#æ­å»ºå¹¶é…ç½®VPS"><span class="nav-number">1.</span> <span class="nav-text">æ­å»ºå¹¶é…ç½®VPS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#åœ¨DigitalOceanä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„Droplet"><span class="nav-number">1.1.</span> <span class="nav-text">åœ¨DigitalOceanä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„Droplet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å¯¹æœåŠ¡å™¨è¿›è¡ŒåŸºç¡€çš„å®‰å…¨è®¾ç½®"><span class="nav-number">1.2.</span> <span class="nav-text">å¯¹æœåŠ¡å™¨è¿›è¡ŒåŸºç¡€çš„å®‰å…¨è®¾ç½®</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è¿è¡ŒNode-js-App"><span class="nav-number">2.</span> <span class="nav-text">è¿è¡ŒNode.js App</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å®‰è£…Git"><span class="nav-number">2.1.</span> <span class="nav-text">å®‰è£…Git</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å®‰è£…MongoDB"><span class="nav-number">2.2.</span> <span class="nav-text">å®‰è£…MongoDB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å®‰è£…Node-js"><span class="nav-number">2.3.</span> <span class="nav-text">å®‰è£…Node.js</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä½¿ç”¨PM2æ¥ç®¡ç†Node-js-App"><span class="nav-number">3.</span> <span class="nav-text">ä½¿ç”¨PM2æ¥ç®¡ç†Node.js App</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å®‰è£…PM2"><span class="nav-number">3.1.</span> <span class="nav-text">å®‰è£…PM2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä½¿ç”¨PM2å¯åŠ¨App"><span class="nav-number">3.2.</span> <span class="nav-text">ä½¿ç”¨PM2å¯åŠ¨App</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è®¾ç½®æœåŠ¡å™¨é‡å¯åè‡ªåŠ¨é‡å¯åº”ç”¨"><span class="nav-number">3.3.</span> <span class="nav-text">è®¾ç½®æœåŠ¡å™¨é‡å¯åè‡ªåŠ¨é‡å¯åº”ç”¨</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä½¿ç”¨Letâ€™s-Encryptè·å–å…è´¹çš„SSL-Certificate"><span class="nav-number">4.</span> <span class="nav-text">ä½¿ç”¨Letâ€™s Encryptè·å–å…è´¹çš„SSL Certificate</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å®‰è£…Letâ€™s-Encrypt"><span class="nav-number">4.1.</span> <span class="nav-text">å®‰è£…Letâ€™s Encrypt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å°†åŸŸåæŒ‡å‘æœåŠ¡å™¨"><span class="nav-number">4.2.</span> <span class="nav-text">å°†åŸŸåæŒ‡å‘æœåŠ¡å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç”ŸæˆSSLè¯ä¹¦"><span class="nav-number">4.3.</span> <span class="nav-text">ç”ŸæˆSSLè¯ä¹¦</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸ºSSLè¯ä¹¦è®¾ç½®è‡ªåŠ¨ç»­è®¢"><span class="nav-number">4.4.</span> <span class="nav-text">ä¸ºSSLè¯ä¹¦è®¾ç½®è‡ªåŠ¨ç»­è®¢</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å°†åŸŸåæŒ‡å‘App"><span class="nav-number">5.</span> <span class="nav-text">å°†åŸŸåæŒ‡å‘App</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å®‰è£…Nginx"><span class="nav-number">5.1.</span> <span class="nav-text">å®‰è£…Nginx</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Louis Melo</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  

  

  

  <!-- <script type="text/javascript" color="0,0,255" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script> -->
</body>
</html>
